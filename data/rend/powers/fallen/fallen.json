{
  "type": "origins:multiple",
  "summoner": {
    "type": "origins:entity_set"
  },
  "chance_for_armour": {
    "type": "origins:action_on_callback",
    "entity_action_gained": {
      "type": "origins:and",
      "actions": [
        {
          "type": "origins:chance",
          "chance": 0.4,
          "success_action": {
            "type": "origins:execute_command",
            "command": "execute unless items entity @s armor.head * run item replace entity @s armor.head with minecraft:chainmail_helmet 1"
          }
        },
        {
          "type": "origins:chance",
          "chance": 0.4,
          "success_action": {
            "type": "origins:execute_command",
            "command": "execute unless items entity @s armor.chest * run item replace entity @s armor.chest with minecraft:chainmail_chestplate 1"
          }
        },
        {
          "type": "origins:chance",
          "chance": 0.4,
          "success_action": {
            "type": "origins:execute_command",
            "command": "execute unless items entity @s armor.legs * run item replace entity @s armor.legs with minecraft:chainmail_leggings 1"
          }
        },
        {
          "type": "origins:chance",
          "chance": 0.4,
          "success_action": {
            "type": "origins:execute_command",
            "command": "execute unless items entity @s armor.feet * run item replace entity @s armor.feet with minecraft:chainmail_boots 1"
          }
        }
      ]
    }
  },
  "set_enemy_when_attacked": {
    "type": "origins:action_when_hit",
    "bientity_action": {
      "type": "origins:and",
      "actions": [
        {
          "type": "origins:target_action",
          "action": {
            "type": "origins:and",
            "actions": [
              {
                "type": "origins:execute_command",
                "command": "execute store result storage minecraft:rend team.counter int 1 run scoreboard players get @s rend_team"
              },
              {
                "type": "origins:execute_command",
                "command": "data modify storage minecraft:rend team.enemy_boolean set value 1"
              },
              {
                "type": "origins:execute_command",
                "command": "scoreboard players operation #rend_attacked_fallen rend_enemy = @s rend_team"
              }
            ]
          }
        },
        {
          "type": "origins:actor_action",
          "action": {
            "type": "origins:if_else",
            "condition": {
              "type": "origins:command",
              "command": "execute if score #rend_attacked_fallen rend_enemy = @s rend_team",
              "comparison": "==",
              "compare_to": 0
            },
            "if_action": {
              "type": "origins:if_else",
              "condition": {
                "type": "origins:power_active",
                "power": "*:fallen/enemy"
              },
              "if_action": {
                "type": "origins:change_resource",
                "resource": "*:fallen/enemy_timer",
                "operation": "set",
                "change": 0
              },
              "else_action": {
                "type": "origins:and",
                "actions": [
                  {
                    "type": "origins:grant_power",
                    "power": "*:fallen/enemy",
                    "source": "*:fallen/fallen_set_enemy_when_attacked"
                  },
                  {
                    "type": "origins:execute_command",
                    "command": "function rend:fallen/set_enemy_score with storage minecraft:rend team"
                  }
                ]
              }
            }
          }
        }
      ]
    },
    "bientity_condition": {
      "type": "origins:invert",
      "condition": {
        "type": "origins:in_entity_set",
        "set": "*:fallen/fallen_summoner",
        "inverted": true
      }
    }
  },
  "prevent_friendly_damage": {
    "type": "origins:modify_damage_taken",
    "bientity_condition": {
      "type": "origins:and",
      "conditions": [
        {
          "type": "origins:actor_condition",
          "condition": {
            "type": "origins:entity_type",
            "entity_type": "minecraft:player",
            "inverted": true
          }
        },
        {
          "type": "origins:actor_condition",
          "condition": {
            "type": "origins:command",
            "command": "execute if score #rend_attacked_fallen rend_enemy = @s rend_team",
            "comparison": "==",
            "compare_to": 1
          }
        }
      ]
    },
    "modifier": {
      "id": "rend:fallen/fallen_prevent_friendly_damage",
      "operation": "set_total",
      "amount": 0
    }
  },
  "weapon_switch": {
    "type": "origins:action_over_time",
    "entity_action": {
      "type": "origins:and",
      "actions": [
        {
          "type": "origins:execute_command",
          "command": "execute store result storage minecraft:rend team.counter int 1 run scoreboard players get @s rend_team"
        },
        {
          "type": "origins:if_else",
          "condition": {
            "type": "origins:entity_in_radius",
            "radius": 16,
            "shape": "sphere",
            "bientity_condition": {
              "type": "origins:and",
              "conditions": [
                {
                  "type": "origins:target_condition",
                  "condition": {
                    "type": "origins:command",
                    "command": "function rend:fallen/is_an_enemy with storage rend team",
                    "comparison": "==",
                    "compare_to": 1
                  }
                },
                { "type": "origins:can_see" }
              ]
            },
            "comparison": ">",
            "compare_to": 0
          },
          "if_action": {
            "type": "origins:and",
            "actions": [
              {
                "type": "origins:execute_command",
                "command": "attribute @s minecraft:generic.attack_damage base set 2"
              },
              {
                "type": "origins:if_else",
                "condition": {
                  "type": "origins:entity_in_radius",
                  "radius": 4,
                  "shape": "sphere",
                  "bientity_condition": {
                    "type": "origins:and",
                    "conditions": [
                      {
                        "type": "origins:target_condition",
                        "condition": {
                          "type": "origins:command",
                          "command": "function rend:fallen/is_an_enemy with storage rend team",
                          "comparison": "==",
                          "compare_to": 1
                        }
                      },
                      { "type": "origins:can_see" }
                    ]
                  },
                  "comparison": ">",
                  "compare_to": 0
                },
                "if_action": {
                  "type": "origins:execute_command",
                  "command": "execute unless items entity @s weapon.mainhand minecraft:iron_sword run item replace entity @s weapon.mainhand with minecraft:iron_sword[enchantments={\"minecraft:sharpness\":3s}] 1"
                },
                "else_action": {
                  "type": "origins:execute_command",
                  "command": "execute unless items entity @s weapon.mainhand minecraft:bow run item replace entity @s weapon.mainhand with minecraft:bow[enchantments={\"minecraft:power\":3s}] 1"
                }
              }
            ]
          },
          "else_action": {
            "type": "origins:execute_command",
            "command": "function rend:fallen/prevent_attack"
          }
        }
      ]
    },
    "interval": 20
  }
}
